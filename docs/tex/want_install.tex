%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%  Copyright (C) 2005 WanT group                         %
%  This file is distributed under the terms of the       %
%  GNU General Public License.                           %
%  See the file `License'  in the root directory of      %
%  the present distribution,                             %
%  or http://www.gnu.org/copyleft/gpl.txt                %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\thispagestyle{empty}
\section{Installation procedure}\label{section:install}

\noindent \underline {NOTES}: (i) The present version of the code
adopts the installation procedure of the \PWSCF\ package (for more details see
also \PWSCFURL). 
Details are also reported in the {\tt \~{}want/docs/README.install} file. \\

\noindent Installation is a two-step procedure:
%
%
\begin{enumerate}
\item \texttt{cd} to the top directory of the \WANT{} tree,
and issue this command at the shell
prompt:\\
{\tt ./configure [$\langle$options$\rangle$] } \\
use the option {\tt -h} or {\tt --help} to get a brief manual.
\item Now run:\\
     {\tt make $\langle$target$\rangle$ }
\end{enumerate}
%
%
where {\tt $\langle$target$\rangle$} is one (or more) of the following:
{\tt wannier, transport, utility, libwant, libiotk, libtools, all, deps, clean, wash}. Running
{\tt make} without arguments prints a short manual.
Cross-compilation is not currently supported.

%----------------------------------------------------------------------
%First step : configuring
%----------------------------------------------------------------------

\subsection{Step one: configuring} {\tt configure} is a GNU-style configuration script,
automatically generated by GNU Autoconf. If you want to play
with it, its source file is {\tt \~{}want/conf/configure.ac}; you may also
want to edit {\tt \~{}want/conf/make.sys.in} or {\tt \~{}want/conf/configure.h.in}. 
It generates the following files: \\

%
%
\begin{tabular}{ll}
  \texttt{\~{}want/make.sys}            &     {compilation settings and flags}\\
  \texttt{\~{}want/include/configure.h} &     {export configuration flags to a inc file}\\
  \texttt{\~{}want/include/ctools.h}    &     {macros for c-sources}\\
  \texttt{\~{}want/include/fft\_defs.h} &     {macros for fft}\\
  \texttt{\~{}want/include/iotk\_config.h} &  {macros for iotk}\\
  \texttt{\~{}want/conf/configure.msg}  &     {summary of configuration}\\
\end{tabular}
%
%
\\

\noindent Files {\tt make.depend} have been generated by the
{\tt \~{}want/conf/makedeps.sh} shell script. If you modify the program sources,
you might have to rerun it or, alternatively, it can be invoked with
{\tt make deps}.  \\

\noindent To force using a particular compiler, or compilation
flags, or libraries, you may set the appropriate environment
variables when running the configuration script.  For example:

%
%
\begin{description}
  \item {\tt ./configure CC=gcc CFLAGS=-O3 LIBS="-llapack -lblas
  -lfftw" }
\end{description}
%
%

\noindent Some of those environment variables are: \\

%
%
\begin{tabular}{ll}
  \texttt{TOPDIR}       &{: top directory of the \WANT{} tree (defaults to `pwd`)}\\
  \texttt{F90, F77, CC} &{: Fortran 90, Fortran 77, and C compilers}\\
  \texttt{CPP}          &{: source file preprocessor (defaults to "\$CC -E")}\\
  \texttt{LD}           &{: linker (defaults to \$F90)}\\
  \texttt{CFLAGS, FFLAGS,}  &  \\
  \texttt{F90FLAGS, CPPFLAGS, LDFLAGS} &{: compilation flags}\\
  \texttt{LIBDIRS}      &{: extra directories to search for libraries (see below)}\\
  \texttt{--enable-parallel}   &{: search for parallel environment (false by default)}\\
\end{tabular}
%
%
\\

\noindent You should always be able to compile the \WANT{} suite of
programs without having to edit any of the generated files.  If
you ever have to, that should be considered a bug in the
configuration script and you are encouraged to submit a bug
report.\\

\noindent \underline {IMPORTANT}: \WANT{} can take advantage of
several
optimized numerical libraries:\\
\noindent -- ESSL on AIX systems (shipped by IBM)\\
\noindent -- MKL together with Intel compilers (shipped by Intel,
free for non-commercial use)\\
\noindent -- ATLAS (freely downloadable from
   \texttt{ http://math-atlas.sourceforge.net })\\
\noindent -- FFTW (freely downloadable from
   \texttt{ http://www.fftw.org})\\

\noindent The configuration script attempts to find those
libraries, but may fail if they have been installed in
non-standard locations. You should look at the LIBS environment
variable (either in the output of the configuration script, or in
the generated {\tt make.sys}) to check whether all available
libraries were found.
If any libraries weren't found, you can rerun the
configuration script and pass it a list of directories to search,
by setting the environment variable LIBDIRS; directories in the
list must be
separated by spaces.  For example:
%
%
\begin{description}
  \item \texttt{ ./configure LIBDIRS="/opt/intel/mkl/mkl61/lib/32
  /usr/local/lib/fftw-2.1.5" }
\end{description}
%
%

\noindent If this still fails, you may set the environment
variable LIBS manually and retry.  For example:
%
%
\begin{description}
  \item \texttt{ ./configure LIBS="-L/cineca/prod/intel/lib -lfftw -llapack
  -lblas" }
\end{description}
%
%

\noindent Beware that in this case, you must specify \textbf{all} the
libraries that you want to link to.  The configuration script will
blindly accept the specified value, and will \textbf{not} search for any
extra library.\\

\noindent If you want to use the FFTW library, the \texttt{fftw.h}
include file is also required.  If the configuration script wasn't
able to find it, you can specify the correct directory in the
INCLUDEFFTW environment variable. For example:
%
%
\begin{description}
  \item {\tt ./configure INCLUDEFFTW="/cineca/lib/fftw-2.1.3/fftw" }
\end{description}
%
%

\newpage
%----------------------------------------------------------------------
%Second step : compiling
%----------------------------------------------------------------------
\subsection{Step two: compiling}
\noindent Here is a list of available compilation targets: \\

%
%
\begin{tabular}{llll}
  \texttt{make wannier}    &  compile & \texttt{disentangle.x} &(step 1)\\
  \texttt{}                &          & \texttt{wannier.x}     &(step 2)\\
  \texttt{}                &          & \texttt{dos.x}         &(post proc)\\
  \texttt{}                &          & \texttt{bands.x}       &(post proc)\\
  \texttt{}                &          & \texttt{plot.x}        &(post proc)\\
  \texttt{}                &          & \texttt{blc2wan.x}     &(post proc)\\
  \texttt{make transport}  &  compile & \texttt{conductor.x}   &(step 3)\\
  \texttt{}                &          & \texttt{current.x}     &(post proc)\\
  \texttt{make utility}    &  compile & auxiliary tools        &\\
  \texttt{make all}        &          & \texttt{make wannier + transport} & \\
  \texttt{make libwant}    &  compile & \WANT{} basic libs       &        \\
  \texttt{make libctools}  &  compile & c-based support       &        \\
  \texttt{make libiotk}    &  compile & Input-Output toolkit lib (iotk)  &        \\
  \texttt{make deps}       &  update  & F90 dependencies &    \\ 
  \texttt{make clean}      &  remove  & Object files, libs and executables &    \\ 
  \texttt{make clean\_test}&  remove  & test output files &    \\ 
  \texttt{make wash}       &  remove  & Configuration files too        &  
\end{tabular}
%
%
\\

\noindent \underline {IMPORTANT}: If you change any compilation or
precompilation option after a previous (successful or failed)
compilation, you must run \texttt{make clean} before recompiling,
unless you know exactly which routines are affected by the changed
options and how to force their recompilation.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\subsection{List of directories}
Within the top directory of the \WANT{} tree there are the
following directories: \\

\begin{tabular}{lll}
{\bf docs}          & $\qquad$  &   documentation files and manual \\
{\bf conf}          & $\qquad$  &   configuration tools \\
{\bf bin}           & $\qquad$  &   links to all the executables \\
{\bf include}       & $\qquad$  &   header files *.h \\
{\bf wannier}       & $\qquad$  &   source files for the Wannier functions suite \\
{\bf transport}     & $\qquad$  &   source files for the transport code \\
{\bf utility}       & $\qquad$  &   source files for auxiliary utilities\\
{\bf libs}          & $\qquad$  &   source files for basic common libraries \\
{\bf iotk}          & $\qquad$  &   source files for the iotk lib (Input-Output ToolKit, by G. Bussi) \\
{\bf ctools}        & $\qquad$  &   source files for c-support\\
{\bf scripts}       & $\qquad$  &   basic scripts\\
{\bf tests}         & $\qquad$  &   tutorial examples for the use of \WANT{}\\
\end{tabular}

